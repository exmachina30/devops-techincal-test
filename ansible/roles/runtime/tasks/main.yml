- name: Install git
  apt:
    name: git
    state: present
    update_cache: yes

- name: Add NodeSource repo
  shell: curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
  args:
    creates: /etc/apt/sources.list.d/nodesource.list

- name: Install Node.js
  apt:
    name: nodejs
    state: present

- name: Install PM2
  npm:
    name: pm2
    global: yes

- name: Enable PM2 startup
  shell: pm2 startup systemd -u ubuntu --hp /home/ubuntu
  args:
    creates: /etc/systemd/system/pm2-ubuntu.service